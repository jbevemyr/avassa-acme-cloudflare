version: '3.8'

services:
  acme-callback:
    build: .
    environment:
      # Obligatoriska variabler (sätt dessa i .env fil eller miljön)
      - CF_API_TOKEN=${CF_API_TOKEN}
      - VOLGA_ROLE_ID=${VOLGA_ROLE_ID}
      - APPROLE_SECRET_ID=${APPROLE_SECRET_ID}
      - API_CA_CERT=${API_CA_CERT}
      
      # Valfria variabler (med defaults)
      - CF_API_BASE=${CF_API_BASE:-https://api.cloudflare.com/client/v4}
      - CF_DEFAULT_TTL=${CF_DEFAULT_TTL:-120}
      - AVASSA_API_HOST=${AVASSA_API_HOST:-https://api.internal:4646}
      - VOLGA_TOPIC_IN=${VOLGA_TOPIC_IN:-acme:requests}
      - VOLGA_TOPIC_OUT=${VOLGA_TOPIC_OUT:-acme:events}
      - VOLGA_CONSUMER_MODE=${VOLGA_CONSUMER_MODE:-exclusive}
      - VOLGA_POSITION=${VOLGA_POSITION:-latest}
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
